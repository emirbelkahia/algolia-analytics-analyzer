<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Algolia Analytics - Analyzer of Hits v1.0</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Font Awesome for LinkedIn icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <!-- Tooltip CSS -->
    <style>
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
            color: blue;
            text-decoration: underline;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #fff;
            border: 1px solid #ccc;
            color: #000;
            text-align: center;
            padding: 5px;
            border-radius: 6px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            box-shadow: 0px 0px 6px #aaa;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
        }

        .form-instructions {
            font-size: 0.9em;
            color: #555;
            margin-top: -10px;
            margin-bottom: 20px;
        }
    </style>

    <!-- Votre script externe unique -->
    <script src="script.js" defer></script>
</head>
<body>

    <!-- Tool Introduction Header -->
    <header class="tool-introduction">
        <h1 class="header-title">Algolia Analytics - Analyzer of Hits v1.0</h1>
        <p class="disclaimer">
            Note: This tool was independently developed by Emir Belkahia, Senior Customer Success Manager at Algolia, in Dec 2023 and updated in Jan 2024. 
            It is not an official Algolia product and is not maintained by Algolia. For questions or improvement suggestions, please contact me on LinkedIn: 
            <a href="https://www.linkedin.com/in/emirbelkahia/" target="_blank">
                <i class="fab fa-linkedin"></i> my LinkedIn profile</a>.
        </p>
        <p class="header-goal">Goal: Find out what percentage of results of a given kind you have on page 1</p>
        <div class="use-cases">
            <p>Example of use case:</p>
            <ul>
                <li>Evaluating the percentage of out-of-stock products in the first result page</li>
                <li>Evaluating the percentage of marketplace sourced products in the first result page</li>
            </ul>
        </div>
        <div class="steps">
            <p>Steps:</p>
            <ul>
                <li>1Ô∏è‚É£ Extract top searches from the Analytics API.</li>
                <li>2Ô∏è‚É£ Retrieve hits via the Search API.</li>
                <li>3Ô∏è‚É£ Calculate the percentage of hits with a specified attribute and value, and download results as a CSV file.</li>
            </ul>
        </div>
        <p class="start-section">Start with Section 1 below üëá</p>
    </header>

    <!-- Section 1 -->
    <section id="section1">
        <h2>Section 1: Information Gathering</h2>
        <p class="section-description">Please enter the following information to generate the CSV file of your top Searches.</p>
        <form id="form1">
            <!-- Champs pour l'Application ID -->
            <label for="applicationId">Algolia Application ID:</label>
            <input type="text" id="applicationId" name="input1" placeholder="ex: 992LFFGOT9">
    
            <!-- Champs pour la cl√© API Analytics -->
            <label for="analyticsApiKey">Analytics API Key:</label>
            <input type="text" id="analyticsApiKey" name="input2" placeholder="ex: 9g985748fd51a6388ed321d9319fu8c5">
    
            <!-- Champs pour le Nom d'Index -->
            <label for="indexName">Index Name:</label>
            <input type="text" id="indexName" name="input3" placeholder="ex: prod_products_fr_fr">
    
            <!-- Start Date Field (Optional) -->
            <label for="startDate">Start Date (optional):</label>
            <input type="date" id="startDate" name="startDate" placeholder="YYYY-MM-DD">
            <p class="form-instructions">
                If you leave this field empty, the tool will retrieve data for the most popular searches from the last 7 days.
            </p>
            
            <!-- End Date Field (Optional) -->
            <label for="endDate">End Date (optional):</label>
            <input type="date" id="endDate" name="endDate" placeholder="YYYY-MM-DD">
            <p class="form-instructions">
                Make sure your selected date range doesn‚Äôt exceed the retention period for your Analytics data. 
                Most customers have 90 or 365 days. If you‚Äôre unsure, start with 90 days. If the file is identical when testing with 100 days, 
                your retention is likely 90 days. If it‚Äôs different, your retention is probably 365 days.
            </p>
    
            <!-- Case √† cocher Debug -->
            <div class="form-group" style="display: flex; align-items: center;">
                <input type="checkbox" id="debugModeCheckbox" name="debugMode" style="margin-right: 10px;">
                <label for="debugModeCheckbox">I already have my csv file containing top searches</label>
            </div>
    
            <button type="submit">Generate my CSV file</button>
        </form>

        <!-- Loader pour Section 1 -->
        <div id="loadingMessage1" class="loader" style="display: none;">Processing, Please wait...</div>

        <!-- Zone d'affichage des r√©sultats pour Section 1 -->
        <div id="output1" style="display: none;">
            <!-- Contenu dynamique ajout√© via JavaScript -->
        </div>
    </section>

    <!-- Section 2 -->
    <section id="section2" style="display: none;">
        <h2>Section 2: Search Extraction</h2>
        <p class="section-description">We'll now pass to the engine the amount of searches you indicated above.</p>
        <form id="form2">
            <label for="searchApiKey">Search API Key:</label>
            <input type="text" id="searchApiKey" name="searchApiKey" required placeholder="ex: afffbece388744ddabcc328a11bdafff">

            <label for="csvFile">Upload CSV File:</label>
            <input type="file" id="csvFile" name="csvFile" accept=".csv" required>

            <label for="numSearchesToProcess">Number of Searches to Process (max 1000):</label>
            <input type="number" id="numSearchesToProcess" name="numSearchesToProcess" min="1" max="1000" required placeholder="ex: 15">

            <label for="attributeToRetrieve">Attribute to Retrieve:</label>
            <input type="text" id="attributeToRetrieve" name="attributeToRetrieve" required placeholder="ex: inStock">

            <label for="numResults">Number of Results per Search:</label>
            <input type="number" id="numResults" name="numResults" min="1" required placeholder="ex: 60, assuming you have 60 results in the first result page">

            <label for="rulesContext">Rules Context (optional):</label>
            <input type="text" id="rulesContext" name="rulesContext" placeholder="ex: mobile">

            <button type="submit">Run Hits Extraction</button>
        </form>
        <div id="loadingMessage2" class="loader" style="display: none;">Processing, Please wait...</div>
        <div id="abTestDetails" style="display: none;"></div>
        <div id="output2" style="display: none;">
            <!-- JSON download link or preview will be added here via JavaScript -->
        </div>
    </section>

    <!-- Section 3 -->
    <section id="section3" style="display: none;">
        <h2>Section 3: Attribute Analysis</h2>
        <p class="section-description">Upload the JSON file and specify the value of the attribute to analyze.</p>
        <form id="form3">
            <label for="jsonFile">Upload JSON File:</label>
            <input type="file" id="jsonFile" name="jsonFile" accept=".json" required>

            <label for="attributeValue">Enter the Value of Attribute to Analyze (e.g true, yellow, ...):</label>
            <input type="text" id="attributeValue" name="attributeValue" required placeholder="ex: true">

            <button type="submit">Analyze and Generate CSV</button>
        </form>
        <div id="output3" style="display: none;">
            <!-- CSV preview and download link will be added here via JavaScript -->
        </div>
    </section>

</body>
</html>
